SHELL = /bin/sh

FC=mpif90

P3DFFT_LIB=${HOME}/lib/p3dfft_2.5.1/lib
P3DFFT_INC=${HOME}/lib/p3dfft_2.5.1/include

LDLIBS= -lp3dfft -lfftw3f_omp -lfftw3f -lm -ldl 

TARGET=cubep3m
FFLAGS=-shared-intel -fpp -g  -O3 -xhost -mcmodel=medium

OBJS=checkpoint.o coarse_mesh.o cubepm.o delete_particles.o p3dfft_coarse.o halofind_particles.o fft_fine.o kernel_initialization_p3dfft.o link_list.o move_grid_back.o mpi_initialization_p3dfft.o particle_initialization.o particle_mesh.o particle_pass.o indexedsort.o timestep.o update_position.o variable_initialization.o 

run: $(TARGET) 

$(TARGET): $(OBJS)
	$(FC) $(FFLAGS) -qopenmp  $^ -o $@ -L$(FFTW_LIB) -L$(P3DFFT_LIB) $(LDLIBS) 

cubepm.o: cubepm.f90 
	$(FC) $(FFLAGS) -qopenmp -c $<  

checkpoint.o: checkpoint.f90 
	$(FC) $(FFLAGS) -c $<

coarse_mesh.o: coarse_mesh.f90
	$(FC) $(FFLAGS) -c $<

delete_particles.o: delete_particles.f90
	$(FC) $(FFLAGS) -c $<

p3dfft_coarse.o: p3dfft_coarse.f90
	$(FC) $(FFLAGS) -I$(FFTW_INC) -I$(P3DFFT_INC) -c $<

halofind_particles.o: halofind_particles.f90
	$(FC) $(FFLAGS) -qopenmp -c $<

fft_fine.o: fft_fine.f90
	$(FC) $(FFLAGS) -I$(FFTW_INC) -qopenmp -c $<

kernel_initialization_p3dfft.o: kernel_initialization_p3dfft.f90
	$(FC) $(FFLAGS) -c $<

link_list.o: link_list.f90
	$(FC) $(FFLAGS) -c $<

move_grid_back.o: move_grid_back.f90
	$(FC) $(FFLAGS) -c $<

mpi_initialization_p3dfft.o: mpi_initialization_p3dfft.f90
	$(FC) $(FFLAGS) -c $<

particle_initialization.o: particle_initialization.f90
	$(FC) $(FFLAGS) -c $<

particle_mesh.o: particle_mesh.f90
	$(FC) $(FFLAGS) -qopenmp -c $<

particle_pass.o: particle_pass.f90
	$(FC) $(FFLAGS) -c $<

indexedsort.o: indexedsort.f90
	$(FC) $(FFLAGS) -c $<

timers.o: timers.f90
	$(FC) $(FFLAGS) -c $<

timestep.o: timestep.f90 
	$(FC) $(FFLAGS) -c $<

update_position.o: update_position.f90
	$(FC) $(FFLAGS) -qopenmp -c $<

variable_initialization.o: variable_initialization.f90
	$(FC) $(FFLAGS) -c $<

clean:
	rm -f *.o *.pc *~ cubep3m

